#!/bin/bash

set -e

# Install Qbec
QBEC_REPO='splunk/qbec'
QBEC_ASSET='qbec-linux-amd64.tar.gz'
QBEC_URL=$(curl -L -s https://api.github.com/repos/${QBEC_REPO}/releases/latest | jq -r ".assets[] | select(.name==\"${QBEC_ASSET}\").browser_download_url")
echo "Downloading $QBEC_URL"
mkdir -p /tmp/qbec; curl -s -L $QBEC_URL | tar -xzC /tmp/qbec; mv /tmp/qbec/qbec /tmp/qbec/jsonnet-qbec ~/bin; rm -r /tmp/qbec

# Install Helm
HELM_REPO=helm/helm
HELM_VERSION=$(curl -L -s https://api.github.com/repos/${HELM_REPO}/releases/latest | jq -r '.tag_name')
echo "Downloading Helm $HELM_VERSION"
mkdir -p /tmp/helm; curl -s -L https://get.helm.sh/helm-$HELM_VERSION-linux-amd64.tar.gz | tar -xzC /tmp/helm; mv /tmp/helm/linux-amd64/helm ~/bin; rm -r /tmp/helm

# Install kbld
KBLD_REPO='vmware-tanzu/carvel-kbld'
KBLD_ASSET='kbld-linux-amd64'
KBLD_URL=$(curl -L -s https://api.github.com/repos/${KBLD_REPO}/releases/latest | jq -r ".assets[] | select(.name==\"${KBLD_ASSET}\").browser_download_url")
echo "Downloading $KBLD_URL"
curl -L -s $KBLD_URL > ~/bin/kbld; chmod +x ~/bin/kbld

# Install vendir
VENDIR_REPO='vmware-tanzu/carvel-vendir'
VENDIR_ASSET='vendir-linux-amd64'
VENDIR_URL=$(curl -L -s https://api.github.com/repos/${VENDIR_REPO}/releases/latest | jq -r ".assets[] | select(.name==\"${VENDIR_ASSET}\").browser_download_url")
echo "Downloading $VENDIR_URL"
curl -L -s $VENDIR_URL > ~/bin/vendir; chmod +x ~/bin/vendir
